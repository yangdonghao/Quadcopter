cscope 15 $HOME\Documents\GitHub2\Quadcopter\MDK\RTE\Device\STM32F407VGTx\STCubeGenerated\Src"               0000009047
	@main.c

34 
	~"¡m32f4xx_h®.h
"

37 
	~"maš.h
"

41 
I2C_HªdËTy³Def
 
	ghi2c1
;

43 
UART_HªdËTy³Def
 
	ghu¬t2
;

44 
DMA_HªdËTy³Def
 
	ghdma_u§¹2_rx
;

45 
DMA_HªdËTy³Def
 
	ghdma_u§¹2_tx
;

49 
ušt8_t
 
	gTxBufãr
[32];

50 
ušt8_t
 
	gRxBUfãr
[32];

54 
Sy¡emClock_CÚfig
();

55 
E¼Ü_HªdËr
();

56 
MX_GPIO_In™
();

57 
MX_DMA_In™
();

58 
MX_I2C1_In™
();

59 
MX_USART2_UART_In™
();

70 
	$maš
()

74 
ušt32_t
 
LED_CouÁ
 = 0;

80 
	`HAL_In™
();

83 
	`Sy¡emClock_CÚfig
();

86 
	`MX_GPIO_In™
();

87 
	`MX_DMA_In™
();

88 
	`MX_I2C1_In™
();

89 
	`MX_USART2_UART_In™
();

92 
	`LED_In™Ÿlize
();

93 
	`LED_On
(2);

95 
	`LED_On
(3);

104 iàÐ(
Timeba£_500ms_ev’_æag
 & 0x01) == 0 )

106 
TxBufãr
[1]++;

107 
	`LED_S‘Out
(
LED_CouÁ
++);

110 
Timeba£_500ms_ev’_æag
 |= 0x01;

121 
	}
}

125 
	$Sy¡emClock_CÚfig
()

128 
RCC_OscIn™Ty³Def
 
RCC_OscIn™SŒuù
;

129 
RCC_ClkIn™Ty³Def
 
RCC_ClkIn™SŒuù
;

131 
	`__HAL_RCC_PWR_CLK_ENABLE
();

133 
	`__HAL_PWR_VOLTAGESCALING_CONFIG
(
PWR_REGULATOR_VOLTAGE_SCALE1
);

135 
RCC_OscIn™SŒuù
.
OscžÏtÜTy³
 = 
RCC_OSCILLATORTYPE_HSI
;

136 
RCC_OscIn™SŒuù
.
HSIS‹
 = 
RCC_HSI_ON
;

137 
RCC_OscIn™SŒuù
.
HSIC®ib¿tiÚV®ue
 = 16;

138 
RCC_OscIn™SŒuù
.
PLL
.
PLLS‹
 = 
RCC_PLL_ON
;

139 
RCC_OscIn™SŒuù
.
PLL
.
PLLSourû
 = 
RCC_PLLSOURCE_HSI
;

140 
RCC_OscIn™SŒuù
.
PLL
.
PLLM
 = 8;

141 
RCC_OscIn™SŒuù
.
PLL
.
PLLN
 = 84;

142 
RCC_OscIn™SŒuù
.
PLL
.
PLLP
 = 
RCC_PLLP_DIV2
;

143 
RCC_OscIn™SŒuù
.
PLL
.
PLLQ
 = 4;

144 ià(
	`HAL_RCC_OscCÚfig
(&
RCC_OscIn™SŒuù
è!ð
HAL_OK
)

146 
	`E¼Ü_HªdËr
();

149 
RCC_ClkIn™SŒuù
.
ClockTy³
 = 
RCC_CLOCKTYPE_HCLK
|
RCC_CLOCKTYPE_SYSCLK


150 |
RCC_CLOCKTYPE_PCLK1
|
RCC_CLOCKTYPE_PCLK2
;

151 
RCC_ClkIn™SŒuù
.
SYSCLKSourû
 = 
RCC_SYSCLKSOURCE_PLLCLK
;

152 
RCC_ClkIn™SŒuù
.
AHBCLKDivid”
 = 
RCC_SYSCLK_DIV1
;

153 
RCC_ClkIn™SŒuù
.
APB1CLKDivid”
 = 
RCC_HCLK_DIV2
;

154 
RCC_ClkIn™SŒuù
.
APB2CLKDivid”
 = 
RCC_HCLK_DIV4
;

155 ià(
	`HAL_RCC_ClockCÚfig
(&
RCC_ClkIn™SŒuù
, 
FLASH_LATENCY_2
è!ð
HAL_OK
)

157 
	`E¼Ü_HªdËr
();

160 
	`HAL_SYSTICK_CÚfig
(
	`HAL_RCC_G‘HCLKF»q
()/1000);

162 
	`HAL_SYSTICK_CLKSourûCÚfig
(
SYSTICK_CLKSOURCE_HCLK
);

165 
	`HAL_NVIC_S‘PriÜ™y
(
SysTick_IRQn
, 0, 0);

166 
	}
}

169 
	$MX_I2C1_In™
()

172 
hi2c1
.
In¡ªû
 = 
I2C1
;

173 
hi2c1
.
In™
.
ClockS³ed
 = 400000;

174 
hi2c1
.
In™
.
DutyCyþe
 = 
I2C_DUTYCYCLE_16_9
;

175 
hi2c1
.
In™
.
OwnAdd»ss1
 = 0;

176 
hi2c1
.
In™
.
Add»ssšgMode
 = 
I2C_ADDRESSINGMODE_7BIT
;

177 
hi2c1
.
In™
.
Du®Add»ssMode
 = 
I2C_DUALADDRESS_DISABLE
;

178 
hi2c1
.
In™
.
OwnAdd»ss2
 = 0;

179 
hi2c1
.
In™
.
G’”®C®lMode
 = 
I2C_GENERALCALL_DISABLE
;

180 
hi2c1
.
In™
.
NoSŒ‘chMode
 = 
I2C_NOSTRETCH_DISABLE
;

181 ià(
	`HAL_I2C_In™
(&
hi2c1
è!ð
HAL_OK
)

183 
	`E¼Ü_HªdËr
();

186 
	}
}

189 
	$MX_USART2_UART_In™
()

192 
hu¬t2
.
In¡ªû
 = 
USART2
;

193 
hu¬t2
.
In™
.
BaudR©e
 = 115200;

194 
hu¬t2
.
In™
.
WÜdL’gth
 = 
UART_WORDLENGTH_8B
;

195 
hu¬t2
.
In™
.
StÝB™s
 = 
UART_STOPBITS_1
;

196 
hu¬t2
.
In™
.
P¬™y
 = 
UART_PARITY_NONE
;

197 
hu¬t2
.
In™
.
Mode
 = 
UART_MODE_TX_RX
;

198 
hu¬t2
.
In™
.
HwFlowCŽ
 = 
UART_HWCONTROL_NONE
;

199 
hu¬t2
.
In™
.
Ov”Sam¶šg
 = 
UART_OVERSAMPLING_16
;

200 ià(
	`HAL_UART_In™
(&
hu¬t2
è!ð
HAL_OK
)

202 
	`E¼Ü_HªdËr
();

205 
	}
}

210 
	$MX_DMA_In™
()

213 
	`__HAL_RCC_DMA1_CLK_ENABLE
();

217 
	`HAL_NVIC_S‘PriÜ™y
(
DMA1_SŒ—m5_IRQn
, 0, 0);

218 
	`HAL_NVIC_EÇbËIRQ
(
DMA1_SŒ—m5_IRQn
);

220 
	`HAL_NVIC_S‘PriÜ™y
(
DMA1_SŒ—m6_IRQn
, 0, 0);

221 
	`HAL_NVIC_EÇbËIRQ
(
DMA1_SŒ—m6_IRQn
);

223 
	}
}

232 
	$MX_GPIO_In™
()

235 
GPIO_In™Ty³Def
 
GPIO_In™SŒuù
;

238 
	`__HAL_RCC_GPIOA_CLK_ENABLE
();

239 
	`__HAL_RCC_GPIOB_CLK_ENABLE
();

242 
GPIO_In™SŒuù
.
Pš
 = 
GPIO_PIN_4
;

243 
GPIO_In™SŒuù
.
Mode
 = 
GPIO_MODE_IT_RISING
;

244 
GPIO_In™SŒuù
.
PuÎ
 = 
GPIO_NOPULL
;

245 
	`HAL_GPIO_In™
(
GPIOB
, &
GPIO_In™SŒuù
);

248 
	`HAL_NVIC_S‘PriÜ™y
(
EXTI4_IRQn
, 0, 0);

249 
	`HAL_NVIC_EÇbËIRQ
(
EXTI4_IRQn
);

251 
	}
}

262 
	$E¼Ü_HªdËr
()

268 
	`LED_On
(0);

269 
	`LED_On
(1);

270 
	`LED_On
(2);

271 
	`LED_On
(3);

272 
	`HAL_D–ay
(1000);

273 
	`LED_Off
(0);

274 
	`LED_Off
(1);

275 
	`LED_Off
(2);

276 
	`LED_Off
(3);

277 
	`HAL_D–ay
(1000);

280 
	}
}

282 #ifdeà
USE_FULL_ASSERT


291 
	$as£¹_çžed
(
ušt8_t
* 
fže
, 
ušt32_t
 
lše
)

298 
	}
}

	@stm32f4xx_hal_msp.c

35 
	~"¡m32f4xx_h®.h
"

37 
DMA_HªdËTy³Def
 
hdma_u§¹2_rx
;

39 
DMA_HªdËTy³Def
 
hdma_u§¹2_tx
;

41 
E¼Ü_HªdËr
();

49 
	$HAL_M¥In™
()

55 
	`HAL_NVIC_S‘PriÜ™yGroupšg
(
NVIC_PRIORITYGROUP_4
);

59 
	`HAL_NVIC_S‘PriÜ™y
(
MemÜyMªagem’t_IRQn
, 0, 0);

61 
	`HAL_NVIC_S‘PriÜ™y
(
BusFauÉ_IRQn
, 0, 0);

63 
	`HAL_NVIC_S‘PriÜ™y
(
U§geFauÉ_IRQn
, 0, 0);

65 
	`HAL_NVIC_S‘PriÜ™y
(
SVC®l_IRQn
, 0, 0);

67 
	`HAL_NVIC_S‘PriÜ™y
(
DebugMÚ™Ü_IRQn
, 0, 0);

69 
	`HAL_NVIC_S‘PriÜ™y
(
P’dSV_IRQn
, 0, 0);

71 
	`HAL_NVIC_S‘PriÜ™y
(
SysTick_IRQn
, 0, 0);

76 
	}
}

78 
	$HAL_I2C_M¥In™
(
I2C_HªdËTy³Def
* 
hi2c
)

81 
GPIO_In™Ty³Def
 
GPIO_In™SŒuù
;

82 if(
hi2c
->
In¡ªû
==
I2C1
)

92 
GPIO_In™SŒuù
.
Pš
 = 
GPIO_PIN_6
|
GPIO_PIN_7
;

93 
GPIO_In™SŒuù
.
Mode
 = 
GPIO_MODE_AF_OD
;

94 
GPIO_In™SŒuù
.
PuÎ
 = 
GPIO_PULLUP
;

95 
GPIO_In™SŒuù
.
S³ed
 = 
GPIO_SPEED_FREQ_VERY_HIGH
;

96 
GPIO_In™SŒuù
.
AÉ”Ç‹
 = 
GPIO_AF4_I2C1
;

97 
	`HAL_GPIO_In™
(
GPIOB
, &
GPIO_In™SŒuù
);

100 
	`__HAL_RCC_I2C1_CLK_ENABLE
();

106 
	}
}

108 
	$HAL_I2C_M¥DeIn™
(
I2C_HªdËTy³Def
* 
hi2c
)

111 if(
hi2c
->
In¡ªû
==
I2C1
)

117 
	`__HAL_RCC_I2C1_CLK_DISABLE
();

123 
	`HAL_GPIO_DeIn™
(
GPIOB
, 
GPIO_PIN_6
|
GPIO_PIN_7
);

130 
	}
}

132 
	$HAL_UART_M¥In™
(
UART_HªdËTy³Def
* 
hu¬t
)

135 
GPIO_In™Ty³Def
 
GPIO_In™SŒuù
;

136 if(
hu¬t
->
In¡ªû
==
USART2
)

142 
	`__HAL_RCC_USART2_CLK_ENABLE
();

148 
GPIO_In™SŒuù
.
Pš
 = 
GPIO_PIN_2
|
GPIO_PIN_3
;

149 
GPIO_In™SŒuù
.
Mode
 = 
GPIO_MODE_AF_PP
;

150 
GPIO_In™SŒuù
.
PuÎ
 = 
GPIO_PULLUP
;

151 
GPIO_In™SŒuù
.
S³ed
 = 
GPIO_SPEED_FREQ_VERY_HIGH
;

152 
GPIO_In™SŒuù
.
AÉ”Ç‹
 = 
GPIO_AF7_USART2
;

153 
	`HAL_GPIO_In™
(
GPIOA
, &
GPIO_In™SŒuù
);

157 
hdma_u§¹2_rx
.
In¡ªû
 = 
DMA1_SŒ—m5
;

158 
hdma_u§¹2_rx
.
In™
.
ChªÃl
 = 
DMA_CHANNEL_4
;

159 
hdma_u§¹2_rx
.
In™
.
DœeùiÚ
 = 
DMA_PERIPH_TO_MEMORY
;

160 
hdma_u§¹2_rx
.
In™
.
P”hInc
 = 
DMA_PINC_DISABLE
;

161 
hdma_u§¹2_rx
.
In™
.
MemInc
 = 
DMA_MINC_ENABLE
;

162 
hdma_u§¹2_rx
.
In™
.
P”hD©aAlignm’t
 = 
DMA_PDATAALIGN_BYTE
;

163 
hdma_u§¹2_rx
.
In™
.
MemD©aAlignm’t
 = 
DMA_MDATAALIGN_BYTE
;

164 
hdma_u§¹2_rx
.
In™
.
Mode
 = 
DMA_NORMAL
;

165 
hdma_u§¹2_rx
.
In™
.
PriÜ™y
 = 
DMA_PRIORITY_LOW
;

166 
hdma_u§¹2_rx
.
In™
.
FIFOMode
 = 
DMA_FIFOMODE_DISABLE
;

167 ià(
	`HAL_DMA_In™
(&
hdma_u§¹2_rx
è!ð
HAL_OK
)

169 
	`E¼Ü_HªdËr
();

172 
	`__HAL_LINKDMA
(
hu¬t
,
hdm¬x
,
hdma_u§¹2_rx
);

174 
hdma_u§¹2_tx
.
In¡ªû
 = 
DMA1_SŒ—m6
;

175 
hdma_u§¹2_tx
.
In™
.
ChªÃl
 = 
DMA_CHANNEL_4
;

176 
hdma_u§¹2_tx
.
In™
.
DœeùiÚ
 = 
DMA_MEMORY_TO_PERIPH
;

177 
hdma_u§¹2_tx
.
In™
.
P”hInc
 = 
DMA_PINC_DISABLE
;

178 
hdma_u§¹2_tx
.
In™
.
MemInc
 = 
DMA_MINC_ENABLE
;

179 
hdma_u§¹2_tx
.
In™
.
P”hD©aAlignm’t
 = 
DMA_PDATAALIGN_BYTE
;

180 
hdma_u§¹2_tx
.
In™
.
MemD©aAlignm’t
 = 
DMA_MDATAALIGN_BYTE
;

181 
hdma_u§¹2_tx
.
In™
.
Mode
 = 
DMA_NORMAL
;

182 
hdma_u§¹2_tx
.
In™
.
PriÜ™y
 = 
DMA_PRIORITY_LOW
;

183 
hdma_u§¹2_tx
.
In™
.
FIFOMode
 = 
DMA_FIFOMODE_DISABLE
;

184 ià(
	`HAL_DMA_In™
(&
hdma_u§¹2_tx
è!ð
HAL_OK
)

186 
	`E¼Ü_HªdËr
();

189 
	`__HAL_LINKDMA
(
hu¬t
,
hdm©x
,
hdma_u§¹2_tx
);

192 
	`HAL_NVIC_S‘PriÜ™y
(
USART2_IRQn
, 0, 0);

193 
	`HAL_NVIC_EÇbËIRQ
(
USART2_IRQn
);

199 
	}
}

201 
	$HAL_UART_M¥DeIn™
(
UART_HªdËTy³Def
* 
hu¬t
)

204 if(
hu¬t
->
In¡ªû
==
USART2
)

210 
	`__HAL_RCC_USART2_CLK_DISABLE
();

216 
	`HAL_GPIO_DeIn™
(
GPIOA
, 
GPIO_PIN_2
|
GPIO_PIN_3
);

219 
	`HAL_DMA_DeIn™
(
hu¬t
->
hdm¬x
);

220 
	`HAL_DMA_DeIn™
(
hu¬t
->
hdm©x
);

223 
	`HAL_NVIC_Di§bËIRQ
(
USART2_IRQn
);

230 
	}
}

	@stm32f4xx_it.c

34 
	~"¡m32f4xx_h®.h
"

35 
	~"¡m32f4xx.h
"

36 
	~"¡m32f4xx_™.h
"

39 
	~"mpu.h
"

41 
ušt16_t
 
	gTimeba£_500ms_ev’_æag
;

47 
DMA_HªdËTy³Def
 
hdma_u§¹2_rx
;

48 
DMA_HªdËTy³Def
 
hdma_u§¹2_tx
;

49 
UART_HªdËTy³Def
 
hu¬t2
;

58 
	$NMI_HªdËr
()

66 
	}
}

71 
	$H¬dFauÉ_HªdËr
()

82 
	}
}

87 
	$MemMªage_HªdËr
()

98 
	}
}

103 
	$BusFauÉ_HªdËr
()

114 
	}
}

119 
	$U§geFauÉ_HªdËr
()

130 
	}
}

135 
	$SVC_HªdËr
()

143 
	}
}

148 
	$DebugMÚ_HªdËr
()

156 
	}
}

161 
	$P’dSV_HªdËr
()

169 
	}
}

174 
	$SysTick_HªdËr
()

179 
	`HAL_IncTick
();

180 
	`HAL_SYSTICK_IRQHªdËr
();

182 iàÐ
	`HAL_G‘Tick
()%500==0 )

184 
Timeba£_500ms_ev’_æag
 = 0;

187 
	}
}

199 
	$EXTI4_IRQHªdËr
()

202 
h®
.
Ãw_gyro
 = 1;

204 
	`HAL_GPIO_EXTI_IRQHªdËr
(
GPIO_PIN_4
);

208 
	}
}

213 
	$DMA1_SŒ—m5_IRQHªdËr
()

218 
	`HAL_DMA_IRQHªdËr
(&
hdma_u§¹2_rx
);

222 
	}
}

227 
	$DMA1_SŒ—m6_IRQHªdËr
()

232 
	`HAL_DMA_IRQHªdËr
(&
hdma_u§¹2_tx
);

236 
	}
}

241 
	$USART2_IRQHªdËr
()

246 
	`HAL_UART_IRQHªdËr
(&
hu¬t2
);

250 
	}
}

	@
1
.
0
3
42
main.c
stm32f4xx_hal_msp.c
stm32f4xx_it.c
