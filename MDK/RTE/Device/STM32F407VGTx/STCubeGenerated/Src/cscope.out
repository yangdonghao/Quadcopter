cscope 15 $HOME\Documents\GitHub\Quadcopter\MDK\RTE\Device\STM32F407VGTx\STCubeGenerated\Src"               0000011084
	@main.c

34 
	~"¡m32f4xx_h®.h
"

37 
	~"maš.h
"

41 
ADC_HªdËTy³Def
 
	ghadc1
;

43 
I2C_HªdËTy³Def
 
	ghi2c1
;

45 
UART_HªdËTy³Def
 
	ghu¬t2
;

46 
DMA_HªdËTy³Def
 
	ghdma_u§¹2_rx
;

47 
DMA_HªdËTy³Def
 
	ghdma_u§¹2_tx
;

51 
ušt8_t
 
	gTxBufãr
[32];

52 
ušt8_t
 
	gRxBufãr
[32];

53 
ušt8_t
 
	gTx_Rx_Mode_FÏg
;

57 
Sy¡emClock_CÚfig
();

58 
E¼Ü_HªdËr
();

59 
MX_GPIO_In™
();

60 
MX_DMA_In™
();

61 
MX_I2C1_In™
();

62 
MX_USART2_UART_In™
();

63 
MX_ADC1_In™
();

74 
	$maš
()

78 
ušt32_t
 
LED_CouÁ
 = 0;

84 
	`HAL_In™
();

87 
	`Sy¡emClock_CÚfig
();

90 
	`MX_GPIO_In™
();

91 
	`MX_DMA_In™
();

92 
	`MX_I2C1_In™
();

93 
	`MX_USART2_UART_In™
();

94 
	`MX_ADC1_In™
();

97 
	`LED_In™Ÿlize
();

98 
	`LED_On
(2);

99 
	`mpu_š™_®l
();

100 
	`LED_On
(3);

102 
	`dmp_£t_fifo_¿‹
(200);

103 
	`šv_£t_qu©_§m¶e_¿‹
(5000L);

114 
	`Mpu_d©a_»äesh
();

116 iàÐ(
Timeba£_500ms_ev’_æag
 & 0x01) == 0 )

122 
Timeba£_500ms_ev’_æag
 |= 0x01;

126 iàÐ(
Timeba£_300ms_ev’_æag
 & 0x01) == 0 )

128 
Timeba£_300ms_ev’_æag
 |= 0x01;

148 iàÐ(
Timeba£_50ms_ev’_æag
 & 0x01) == 0 )

150 
Timeba£_50ms_ev’_æag
 |= 0x01;

151 
	`LED_S‘Out
(
LED_CouÁ
++);

162 
	}
}

166 
	$Sy¡emClock_CÚfig
()

169 
RCC_OscIn™Ty³Def
 
RCC_OscIn™SŒuù
;

170 
RCC_ClkIn™Ty³Def
 
RCC_ClkIn™SŒuù
;

172 
	`__HAL_RCC_PWR_CLK_ENABLE
();

174 
	`__HAL_PWR_VOLTAGESCALING_CONFIG
(
PWR_REGULATOR_VOLTAGE_SCALE1
);

176 
RCC_OscIn™SŒuù
.
OscžÏtÜTy³
 = 
RCC_OSCILLATORTYPE_HSI
;

177 
RCC_OscIn™SŒuù
.
HSIS‹
 = 
RCC_HSI_ON
;

178 
RCC_OscIn™SŒuù
.
HSIC®ib¿tiÚV®ue
 = 16;

179 
RCC_OscIn™SŒuù
.
PLL
.
PLLS‹
 = 
RCC_PLL_ON
;

180 
RCC_OscIn™SŒuù
.
PLL
.
PLLSourû
 = 
RCC_PLLSOURCE_HSI
;

181 
RCC_OscIn™SŒuù
.
PLL
.
PLLM
 = 8;

182 
RCC_OscIn™SŒuù
.
PLL
.
PLLN
 = 50;

183 
RCC_OscIn™SŒuù
.
PLL
.
PLLP
 = 
RCC_PLLP_DIV2
;

184 
RCC_OscIn™SŒuù
.
PLL
.
PLLQ
 = 4;

185 ià(
	`HAL_RCC_OscCÚfig
(&
RCC_OscIn™SŒuù
è!ð
HAL_OK
)

187 
	`E¼Ü_HªdËr
();

190 
RCC_ClkIn™SŒuù
.
ClockTy³
 = 
RCC_CLOCKTYPE_HCLK
|
RCC_CLOCKTYPE_SYSCLK


191 |
RCC_CLOCKTYPE_PCLK1
|
RCC_CLOCKTYPE_PCLK2
;

192 
RCC_ClkIn™SŒuù
.
SYSCLKSourû
 = 
RCC_SYSCLKSOURCE_PLLCLK
;

193 
RCC_ClkIn™SŒuù
.
AHBCLKDivid”
 = 
RCC_SYSCLK_DIV1
;

194 
RCC_ClkIn™SŒuù
.
APB1CLKDivid”
 = 
RCC_HCLK_DIV2
;

195 
RCC_ClkIn™SŒuù
.
APB2CLKDivid”
 = 
RCC_HCLK_DIV1
;

196 ià(
	`HAL_RCC_ClockCÚfig
(&
RCC_ClkIn™SŒuù
, 
FLASH_LATENCY_1
è!ð
HAL_OK
)

198 
	`E¼Ü_HªdËr
();

201 
	`HAL_SYSTICK_CÚfig
(
	`HAL_RCC_G‘HCLKF»q
()/1000);

203 
	`HAL_SYSTICK_CLKSourûCÚfig
(
SYSTICK_CLKSOURCE_HCLK
);

206 
	`HAL_NVIC_S‘PriÜ™y
(
SysTick_IRQn
, 0, 0);

207 
	}
}

210 
	$MX_ADC1_In™
()

213 
ADC_ChªÃlCÚfTy³Def
 
sCÚfig
;

217 
hadc1
.
In¡ªû
 = 
ADC1
;

218 
hadc1
.
In™
.
ClockP»sÿËr
 = 
ADC_CLOCK_SYNC_PCLK_DIV2
;

219 
hadc1
.
In™
.
ResÞutiÚ
 = 
ADC_RESOLUTION_12B
;

220 
hadc1
.
In™
.
SÿnCÚvMode
 = 
DISABLE
;

221 
hadc1
.
In™
.
CÚtšuousCÚvMode
 = 
DISABLE
;

222 
hadc1
.
In™
.
DiscÚtšuousCÚvMode
 = 
DISABLE
;

223 
hadc1
.
In™
.
Ex‹º®TrigCÚvEdge
 = 
ADC_EXTERNALTRIGCONVEDGE_NONE
;

224 
hadc1
.
In™
.
D©aAlign
 = 
ADC_DATAALIGN_RIGHT
;

225 
hadc1
.
In™
.
NbrOfCÚv”siÚ
 = 1;

226 
hadc1
.
In™
.
DMACÚtšuousReque¡s
 = 
DISABLE
;

227 
hadc1
.
In™
.
EOCS–eùiÚ
 = 
ADC_EOC_SINGLE_CONV
;

228 ià(
	`HAL_ADC_In™
(&
hadc1
è!ð
HAL_OK
)

230 
	`E¼Ü_HªdËr
();

235 
sCÚfig
.
ChªÃl
 = 
ADC_CHANNEL_5
;

236 
sCÚfig
.
Rªk
 = 1;

237 
sCÚfig
.
Sam¶šgTime
 = 
ADC_SAMPLETIME_3CYCLES
;

238 ià(
	`HAL_ADC_CÚfigChªÃl
(&
hadc1
, &
sCÚfig
è!ð
HAL_OK
)

240 
	`E¼Ü_HªdËr
();

243 
	}
}

246 
	$MX_I2C1_In™
()

249 
hi2c1
.
In¡ªû
 = 
I2C1
;

250 
hi2c1
.
In™
.
ClockS³ed
 = 400000;

251 
hi2c1
.
In™
.
DutyCyþe
 = 
I2C_DUTYCYCLE_16_9
;

252 
hi2c1
.
In™
.
OwnAdd»ss1
 = 0;

253 
hi2c1
.
In™
.
Add»ssšgMode
 = 
I2C_ADDRESSINGMODE_7BIT
;

254 
hi2c1
.
In™
.
Du®Add»ssMode
 = 
I2C_DUALADDRESS_DISABLE
;

255 
hi2c1
.
In™
.
OwnAdd»ss2
 = 0;

256 
hi2c1
.
In™
.
G’”®C®lMode
 = 
I2C_GENERALCALL_DISABLE
;

257 
hi2c1
.
In™
.
NoSŒ‘chMode
 = 
I2C_NOSTRETCH_DISABLE
;

258 ià(
	`HAL_I2C_In™
(&
hi2c1
è!ð
HAL_OK
)

260 
	`E¼Ü_HªdËr
();

263 
	}
}

266 
	$MX_USART2_UART_In™
()

269 
hu¬t2
.
In¡ªû
 = 
USART2
;

270 
hu¬t2
.
In™
.
BaudR©e
 = 115200;

271 
hu¬t2
.
In™
.
WÜdL’gth
 = 
UART_WORDLENGTH_8B
;

272 
hu¬t2
.
In™
.
StÝB™s
 = 
UART_STOPBITS_1
;

273 
hu¬t2
.
In™
.
P¬™y
 = 
UART_PARITY_NONE
;

274 
hu¬t2
.
In™
.
Mode
 = 
UART_MODE_TX_RX
;

275 
hu¬t2
.
In™
.
HwFlowCŽ
 = 
UART_HWCONTROL_NONE
;

276 
hu¬t2
.
In™
.
Ov”Sam¶šg
 = 
UART_OVERSAMPLING_16
;

277 ià(
	`HAL_UART_In™
(&
hu¬t2
è!ð
HAL_OK
)

279 
	`E¼Ü_HªdËr
();

282 
	}
}

287 
	$MX_DMA_In™
()

290 
	`__HAL_RCC_DMA1_CLK_ENABLE
();

294 
	`HAL_NVIC_S‘PriÜ™y
(
DMA1_SŒ—m5_IRQn
, 0, 0);

295 
	`HAL_NVIC_EÇbËIRQ
(
DMA1_SŒ—m5_IRQn
);

297 
	`HAL_NVIC_S‘PriÜ™y
(
DMA1_SŒ—m6_IRQn
, 0, 0);

298 
	`HAL_NVIC_EÇbËIRQ
(
DMA1_SŒ—m6_IRQn
);

300 
	}
}

309 
	$MX_GPIO_In™
()

312 
GPIO_In™Ty³Def
 
GPIO_In™SŒuù
;

315 
	`__HAL_RCC_GPIOA_CLK_ENABLE
();

316 
	`__HAL_RCC_GPIOB_CLK_ENABLE
();

319 
GPIO_In™SŒuù
.
Pš
 = 
GPIO_PIN_4
;

320 
GPIO_In™SŒuù
.
Mode
 = 
GPIO_MODE_IT_RISING
;

321 
GPIO_In™SŒuù
.
PuÎ
 = 
GPIO_NOPULL
;

322 
	`HAL_GPIO_In™
(
GPIOB
, &
GPIO_In™SŒuù
);

325 
	`HAL_NVIC_S‘PriÜ™y
(
EXTI4_IRQn
, 0, 0);

326 
	`HAL_NVIC_EÇbËIRQ
(
EXTI4_IRQn
);

328 
	}
}

339 
	$E¼Ü_HªdËr
()

345 
	`LED_On
(0);

346 
	`LED_On
(1);

347 
	`LED_On
(2);

348 
	`LED_On
(3);

349 
	`HAL_D–ay
(1000);

350 
	`LED_Off
(0);

351 
	`LED_Off
(1);

352 
	`LED_Off
(2);

353 
	`LED_Off
(3);

354 
	`HAL_D–ay
(1000);

357 
	}
}

359 #ifdeà
USE_FULL_ASSERT


368 
	$as£¹_çžed
(
ušt8_t
* 
fže
, 
ušt32_t
 
lše
)

375 
	}
}

	@stm32f4xx_hal_msp.c

35 
	~"¡m32f4xx_h®.h
"

37 
DMA_HªdËTy³Def
 
hdma_u§¹2_rx
;

39 
DMA_HªdËTy³Def
 
hdma_u§¹2_tx
;

41 
E¼Ü_HªdËr
();

49 
	$HAL_M¥In™
()

55 
	`HAL_NVIC_S‘PriÜ™yGroupšg
(
NVIC_PRIORITYGROUP_4
);

59 
	`HAL_NVIC_S‘PriÜ™y
(
MemÜyMªagem’t_IRQn
, 0, 0);

61 
	`HAL_NVIC_S‘PriÜ™y
(
BusFauÉ_IRQn
, 0, 0);

63 
	`HAL_NVIC_S‘PriÜ™y
(
U§geFauÉ_IRQn
, 0, 0);

65 
	`HAL_NVIC_S‘PriÜ™y
(
SVC®l_IRQn
, 0, 0);

67 
	`HAL_NVIC_S‘PriÜ™y
(
DebugMÚ™Ü_IRQn
, 0, 0);

69 
	`HAL_NVIC_S‘PriÜ™y
(
P’dSV_IRQn
, 0, 0);

71 
	`HAL_NVIC_S‘PriÜ™y
(
SysTick_IRQn
, 0, 0);

76 
	}
}

78 
	$HAL_ADC_M¥In™
(
ADC_HªdËTy³Def
* 
hadc
)

81 
GPIO_In™Ty³Def
 
GPIO_In™SŒuù
;

82 if(
hadc
->
In¡ªû
==
ADC1
)

88 
	`__HAL_RCC_ADC1_CLK_ENABLE
();

93 
GPIO_In™SŒuù
.
Pš
 = 
GPIO_PIN_5
;

94 
GPIO_In™SŒuù
.
Mode
 = 
GPIO_MODE_ANALOG
;

95 
GPIO_In™SŒuù
.
PuÎ
 = 
GPIO_NOPULL
;

96 
	`HAL_GPIO_In™
(
GPIOA
, &
GPIO_In™SŒuù
);

103 
	}
}

105 
	$HAL_ADC_M¥DeIn™
(
ADC_HªdËTy³Def
* 
hadc
)

108 if(
hadc
->
In¡ªû
==
ADC1
)

114 
	`__HAL_RCC_ADC1_CLK_DISABLE
();

119 
	`HAL_GPIO_DeIn™
(
GPIOA
, 
GPIO_PIN_5
);

126 
	}
}

128 
	$HAL_I2C_M¥In™
(
I2C_HªdËTy³Def
* 
hi2c
)

131 
GPIO_In™Ty³Def
 
GPIO_In™SŒuù
;

132 if(
hi2c
->
In¡ªû
==
I2C1
)

142 
GPIO_In™SŒuù
.
Pš
 = 
GPIO_PIN_6
|
GPIO_PIN_7
;

143 
GPIO_In™SŒuù
.
Mode
 = 
GPIO_MODE_AF_OD
;

144 
GPIO_In™SŒuù
.
PuÎ
 = 
GPIO_PULLUP
;

145 
GPIO_In™SŒuù
.
S³ed
 = 
GPIO_SPEED_FREQ_VERY_HIGH
;

146 
GPIO_In™SŒuù
.
AÉ”Ç‹
 = 
GPIO_AF4_I2C1
;

147 
	`HAL_GPIO_In™
(
GPIOB
, &
GPIO_In™SŒuù
);

150 
	`__HAL_RCC_I2C1_CLK_ENABLE
();

156 
	}
}

158 
	$HAL_I2C_M¥DeIn™
(
I2C_HªdËTy³Def
* 
hi2c
)

161 if(
hi2c
->
In¡ªû
==
I2C1
)

167 
	`__HAL_RCC_I2C1_CLK_DISABLE
();

173 
	`HAL_GPIO_DeIn™
(
GPIOB
, 
GPIO_PIN_6
|
GPIO_PIN_7
);

180 
	}
}

182 
	$HAL_UART_M¥In™
(
UART_HªdËTy³Def
* 
hu¬t
)

185 
GPIO_In™Ty³Def
 
GPIO_In™SŒuù
;

186 if(
hu¬t
->
In¡ªû
==
USART2
)

192 
	`__HAL_RCC_USART2_CLK_ENABLE
();

198 
GPIO_In™SŒuù
.
Pš
 = 
GPIO_PIN_2
|
GPIO_PIN_3
;

199 
GPIO_In™SŒuù
.
Mode
 = 
GPIO_MODE_AF_PP
;

200 
GPIO_In™SŒuù
.
PuÎ
 = 
GPIO_PULLUP
;

201 
GPIO_In™SŒuù
.
S³ed
 = 
GPIO_SPEED_FREQ_HIGH
;

202 
GPIO_In™SŒuù
.
AÉ”Ç‹
 = 
GPIO_AF7_USART2
;

203 
	`HAL_GPIO_In™
(
GPIOA
, &
GPIO_In™SŒuù
);

207 
hdma_u§¹2_rx
.
In¡ªû
 = 
DMA1_SŒ—m5
;

208 
hdma_u§¹2_rx
.
In™
.
ChªÃl
 = 
DMA_CHANNEL_4
;

209 
hdma_u§¹2_rx
.
In™
.
DœeùiÚ
 = 
DMA_PERIPH_TO_MEMORY
;

210 
hdma_u§¹2_rx
.
In™
.
P”hInc
 = 
DMA_PINC_DISABLE
;

211 
hdma_u§¹2_rx
.
In™
.
MemInc
 = 
DMA_MINC_ENABLE
;

212 
hdma_u§¹2_rx
.
In™
.
P”hD©aAlignm’t
 = 
DMA_PDATAALIGN_BYTE
;

213 
hdma_u§¹2_rx
.
In™
.
MemD©aAlignm’t
 = 
DMA_MDATAALIGN_BYTE
;

214 
hdma_u§¹2_rx
.
In™
.
Mode
 = 
DMA_NORMAL
;

215 
hdma_u§¹2_rx
.
In™
.
PriÜ™y
 = 
DMA_PRIORITY_LOW
;

216 
hdma_u§¹2_rx
.
In™
.
FIFOMode
 = 
DMA_FIFOMODE_DISABLE
;

217 ià(
	`HAL_DMA_In™
(&
hdma_u§¹2_rx
è!ð
HAL_OK
)

219 
	`E¼Ü_HªdËr
();

222 
	`__HAL_LINKDMA
(
hu¬t
,
hdm¬x
,
hdma_u§¹2_rx
);

224 
hdma_u§¹2_tx
.
In¡ªû
 = 
DMA1_SŒ—m6
;

225 
hdma_u§¹2_tx
.
In™
.
ChªÃl
 = 
DMA_CHANNEL_4
;

226 
hdma_u§¹2_tx
.
In™
.
DœeùiÚ
 = 
DMA_MEMORY_TO_PERIPH
;

227 
hdma_u§¹2_tx
.
In™
.
P”hInc
 = 
DMA_PINC_DISABLE
;

228 
hdma_u§¹2_tx
.
In™
.
MemInc
 = 
DMA_MINC_ENABLE
;

229 
hdma_u§¹2_tx
.
In™
.
P”hD©aAlignm’t
 = 
DMA_PDATAALIGN_BYTE
;

230 
hdma_u§¹2_tx
.
In™
.
MemD©aAlignm’t
 = 
DMA_MDATAALIGN_BYTE
;

231 
hdma_u§¹2_tx
.
In™
.
Mode
 = 
DMA_NORMAL
;

232 
hdma_u§¹2_tx
.
In™
.
PriÜ™y
 = 
DMA_PRIORITY_LOW
;

233 
hdma_u§¹2_tx
.
In™
.
FIFOMode
 = 
DMA_FIFOMODE_DISABLE
;

234 ià(
	`HAL_DMA_In™
(&
hdma_u§¹2_tx
è!ð
HAL_OK
)

236 
	`E¼Ü_HªdËr
();

239 
	`__HAL_LINKDMA
(
hu¬t
,
hdm©x
,
hdma_u§¹2_tx
);

242 
	`HAL_NVIC_S‘PriÜ™y
(
USART2_IRQn
, 0, 0);

243 
	`HAL_NVIC_EÇbËIRQ
(
USART2_IRQn
);

249 
	}
}

251 
	$HAL_UART_M¥DeIn™
(
UART_HªdËTy³Def
* 
hu¬t
)

254 if(
hu¬t
->
In¡ªû
==
USART2
)

260 
	`__HAL_RCC_USART2_CLK_DISABLE
();

266 
	`HAL_GPIO_DeIn™
(
GPIOA
, 
GPIO_PIN_2
|
GPIO_PIN_3
);

269 
	`HAL_DMA_DeIn™
(
hu¬t
->
hdm¬x
);

270 
	`HAL_DMA_DeIn™
(
hu¬t
->
hdm©x
);

273 
	`HAL_NVIC_Di§bËIRQ
(
USART2_IRQn
);

280 
	}
}

	@stm32f4xx_it.c

34 
	~"¡m32f4xx_h®.h
"

35 
	~"¡m32f4xx.h
"

36 
	~"¡m32f4xx_™.h
"

39 
	~"mpu.h
"

41 
ušt16_t
 
	gTimeba£_500ms_ev’_æag
;

42 
ušt16_t
 
	gTimeba£_300ms_ev’_æag
;

43 
ušt16_t
 
	gTimeba£_50ms_ev’_æag
;

48 
DMA_HªdËTy³Def
 
hdma_u§¹2_rx
;

49 
DMA_HªdËTy³Def
 
hdma_u§¹2_tx
;

50 
UART_HªdËTy³Def
 
hu¬t2
;

59 
	$NMI_HªdËr
()

67 
	}
}

72 
	$H¬dFauÉ_HªdËr
()

83 
	}
}

88 
	$MemMªage_HªdËr
()

99 
	}
}

104 
	$BusFauÉ_HªdËr
()

115 
	}
}

120 
	$U§geFauÉ_HªdËr
()

131 
	}
}

136 
	$SVC_HªdËr
()

144 
	}
}

149 
	$DebugMÚ_HªdËr
()

157 
	}
}

162 
	$P’dSV_HªdËr
()

170 
	}
}

175 
	$SysTick_HªdËr
()

184 
	`HAL_IncTick
();

185 
	`HAL_SYSTICK_IRQHªdËr
();

187 iàÐ
	`HAL_G‘Tick
()%300==0 )

189 
Timeba£_300ms_ev’_æag
 = 0;

191 iàÐ
	`HAL_G‘Tick
()%500==0 )

193 
Timeba£_500ms_ev’_æag
 = 0;

195 iàÐ
	`HAL_G‘Tick
()%50==0 )

197 
Timeba£_50ms_ev’_æag
 = 0;

200 
	}
}

212 
	$EXTI4_IRQHªdËr
()

215 
h®
.
Ãw_gyro
 = 1;

217 
	`HAL_GPIO_EXTI_IRQHªdËr
(
GPIO_PIN_4
);

221 
	}
}

226 
	$DMA1_SŒ—m5_IRQHªdËr
()

231 
	`HAL_DMA_IRQHªdËr
(&
hdma_u§¹2_rx
);

235 
	}
}

240 
	$DMA1_SŒ—m6_IRQHªdËr
()

245 
	`HAL_DMA_IRQHªdËr
(&
hdma_u§¹2_tx
);

249 
	}
}

254 
	$USART2_IRQHªdËr
()

259 
	`HAL_UART_IRQHªdËr
(&
hu¬t2
);

263 
	}
}

	@
1
.
0
3
42
main.c
stm32f4xx_hal_msp.c
stm32f4xx_it.c
